# Tunnox Core Server Configuration
# 服务器配置文件
#
# 注意：所有配置项都是可选的，未配置的项将使用默认值
# 支持零配置启动，直接运行即可
# 只需配置需要修改的部分，其他保持默认即可

server:
  # 多协议监听配置
  protocols:
    tcp:
      enabled: true
      port: 8000
      host: "0.0.0.0"
    websocket:
      enabled: true
      port: 8443
      host: "0.0.0.0"
    udp:
      enabled: false
      port: 8000
      host: "0.0.0.0"
    quic:
      enabled: true
      port: 443
      host: "0.0.0.0"

log:
  # 日志级别: debug, info, warn, error, fatal, panic
  level: "info"
  
  # 日志格式: json, text
  format: "text"
  
  # 输出位置: stdout, stderr, file
  output: "stdout"
  
  # 日志文件路径（当 output 为 file 时使用）
  file: "logs/server.log"
  
  # 日志轮转配置
  rotation:
    max_size: 100    # 单个日志文件最大大小（MB）
    max_age: 30      # 日志文件保留天数
    max_backups: 10  # 保留的备份文件数量
    compress: true   # 是否压缩备份文件

cloud:
  # 云控类型: built_in, external
  type: "built_in"
  
  # 内置云控配置
  built_in:
    # JWT 配置
    jwt_secret_key: "your-secret-key-change-this-in-production"
    jwt_expiration: 3600        # JWT 过期时间（秒）
    refresh_expiration: 604800  # 刷新令牌过期时间（秒）
    jwt_issuer: "tunnox"
    
    # 数据清理配置
    cleanup_interval: 300       # 清理间隔（秒）
    data_ttl: 86400            # 数据生存时间（秒）
    
    # ID 生成配置
    id_length: 16              # ID 长度
    max_attempts: 10           # 最大重试次数

  # 外部云控配置（当 type 为 external 时使用）
  external:
    api_endpoint: "http://localhost:8080"
    api_key: ""
    api_secret: ""
    timeout: 30


# 消息代理配置
message_broker:
  type: "memory"  # memory | redis

# 存储配置
storage:
  # 存储类型: memory | redis | hybrid
  type: hybrid
  
  # 混合存储配置
  hybrid:
    cache_type: memory        # memory | redis
    enable_persistent: true   # 是否启用持久化

# Management API 配置
management_api:
  enabled: true
  listen_addr: "0.0.0.0:9000"
  
  # 认证配置
  auth:
    type: "bearer"            # bearer | basic | none
    token: "your-api-key-here" # Bearer token（请修改为安全的密钥）
  
  # PProf 性能分析配置
  pprof:
    enabled: true              # 是否启用 pprof（默认启用，需要密钥访问）
    data_dir: "logs/pprof"     # pprof 数据保存目录
    retention: 10              # 保留分钟数（默认10分钟，最多保留10份文件）
    auto_capture: true         # 是否自动抓取（每分钟抓取一次）

# Metrics 配置
metrics:
  type: memory  # memory | prometheus（单文件运行使用 memory） 